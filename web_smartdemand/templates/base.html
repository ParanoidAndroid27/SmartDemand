{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}SmartDemand{% endblock %}</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <!-- CSS exclusivo para base.html -->
  <link rel="stylesheet" href="{% static 'css/base.css' %}"/>
  <link rel="stylesheet" href="{% static 'css/home/Page_Style.css' %}"/>
  {% block extra_css %}{% endblock %}
</head>
<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-glass fixed-top shadow-lg py-1">
    <div class="container px-4">
      <!-- Menú desplegable usuario + logo -->
      <div class="dropdown me-3">
        <a class="navbar-brand d-flex align-items-center gap-2 dropdown-toggle" href="#" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
          <img src="{% static 'img/Logopequeño.png' %}" alt="SmartDemand Logo" class="logo-navbar-sm">
        </a>
        <ul class="dropdown-menu dropdown-menu-user p-3" aria-labelledby="userMenu">
          {% if user.is_authenticated %}
          <li class="d-flex align-items-center gap-2 mb-2">
            <div class="user-avatar">
              <img src="{% if user.userprofile.foto_perfil %}{{ user.userprofile.foto_perfil.url }}{% else %}{% static 'img/usuario.png' %}{% endif %}" alt="Usuario" class="rounded-circle" width="48" height="48">
            </div>
            <span class="fw-semibold">{{ user.get_full_name|default:user.username }}</span>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_perfil:perfil' %}">
              <i class="bi bi-person-fill me-2"></i>Mi perfil
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          {% endif %}
          <li>
            <a class="dropdown-item" href="{% url 'web_smartdemand:principal_page' %}">
              <i class="bi bi-house-fill me-2"></i>Inicio
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_gestion_productos:lista_productos' %}">
              <i class="bi bi-box2-fill me-2"></i>Mis productos
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_alertas_stock:ver_alertas' %}">
              <i class="bi bi-bell-fill me-2"></i>Notificaciones
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#">
              <i class="bi bi-sliders me-2"></i>Configuración
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item" href="{% url 'app_cargar_productos:agregar_producto' %}">
              <i class="bi bi-plus-circle-fill me-2"></i>Agregar Producto
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_ventas_productos:registrar_venta' %}">
              <i class="bi bi-cart-plus-fill me-2"></i>Agregar Venta
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_prediccion:dashboard_prediccion' %}">
              <i class="bi bi-bar-chart-fill me-2"></i>Análisis de Negocio
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_entornos_trabajo:gestionar_entorno' %}">
              <i class="bi bi-diagram-3-fill me-2"></i>Entorno de trabajo
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="{% url 'app_prediccion:ultimas_exportaciones' %}">
              <i class="bi bi-file-earmark-arrow-down me-2"></i> Mis exportaciones
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item text-danger" href="{% url 'logout' %}">
              <i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión
            </a>
          </li>
        </ul>
      </div>
      <!-- Búsqueda solo escritorio -->
      <form class="position-relative" method="get" action="{% url 'app_gestion_productos:buscar_productos' %}" autocomplete="off">
        <input id="busqueda-productos" class="form-control search-navbar" type="search" name="q" placeholder="Buscar productos..." aria-label="Buscar productos" autocomplete="off">
        <div id="sugerencias-productos" class="list-group position-absolute w-100" style="z-index: 1000; top: 100%;"></div>
      </form>
      <!-- Botón hamburguesa móvil -->
      <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Enlaces principales -->
      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-2">
          <li class="nav-item ms-lg-2">
            <a class="nav-link nav-link-modern" href="{% url 'login' %}">Cerrar sesión</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ESPACIADOR PARA LA NAVBAR FIJA -->
  <div style="height: 70px;"></div>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="mb-5">
    {% block content %}
    {% endblock %}
  </div>

  <!-- FOOTER -->
  <footer class="footer-modern py-4 mt-auto" style="background: rgba(255,255,255,0.92);">
    <div class="container">
      <div class="row text-center text-md-start align-items-center">
        <div class="col-md-4 mb-3 mb-md-0">
          <img src="{% static 'img/logo_fondo_blanco.png' %}"
               width="80"
               alt="Logo Footer"
               class="mb-3 bg-white p-2 rounded-circle shadow" />
          <p class="mb-1 text-dark">
            <strong>SmartDemand</strong> <br/>
            La mejor solución para tu negocio.
          </p>
        </div>
        <div class="col-md-4 mb-3 mb-md-0 text-center">
          <h6 class="text-dark fw-semibold mb-3">Enlaces Rápidos</h6>
          <ul class="list-unstyled">
            <li class="mb-1"><a href="#" class="text-dark">Productos</a></li>
            <li class="mb-1"><a href="#" class="text-dark">Soluciones</a></li>
            <li class="mb-1"><a href="#" class="text-dark">Comunidad</a></li>
            <li><a href="#" class="text-dark">Precios</a></li>
          </ul>
        </div>
        <div class="col-md-4 text-md-end text-center">
          <h6 class="text-dark fw-semibold mb-3">Síguenos</h6>
          <a href="#" class="text-dark me-3"><i class="bi bi-facebook fs-4"></i></a>
          <a href="#" class="text-dark me-3"><i class="bi bi-twitter fs-4"></i></a>
          <a href="#" class="text-dark"><i class="bi bi-linkedin fs-4"></i></a>
          <p class="mt-3 text-dark mb-0">© 2025 SmartDemand – Todos los derechos reservados</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  {% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('busqueda-productos');
  const sugerencias = document.getElementById('sugerencias-productos');

  input.addEventListener('input', function() {
    const q = input.value.trim();
    if (q.length < 2) {
      sugerencias.innerHTML = '';
      sugerencias.style.display = 'none';
      return;
    }
    fetch("{% url 'app_gestion_productos:autocomplete_productos' %}?q=" + encodeURIComponent(q))
      .then(response => response.json())
      .then(data => {
        sugerencias.innerHTML = '';
        if (data.length === 0) {
          sugerencias.style.display = 'none';
          return;
        }
        data.forEach(item => {
          const a = document.createElement('a');
          a.className = 'list-group-item list-group-item-action';
          a.href = "{% url 'app_gestion_productos:detalle_producto' 0 %}".replace('0', item.id);
          a.textContent = item.nombre;
          sugerencias.appendChild(a);
        });
        sugerencias.style.display = 'block';
      });
  });

  input.addEventListener('blur', function() {
    setTimeout(() => { sugerencias.style.display = 'none'; }, 150);
  });
  input.addEventListener('focus', function() {
    if (sugerencias.innerHTML.trim() !== '') {
      sugerencias.style.display = 'block';
    }
  });
});
</script>
{% endblock %}
</body>
</html>