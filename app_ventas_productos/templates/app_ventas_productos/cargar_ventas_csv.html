{% extends "base.html" %}
{% load static %}

{% block title %}Cargar Ventas por CSV - SmartDemand{% endblock %}

{% block content %}
<main class="container flex-grow-1">
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="glass-panel card shadow-lg mb-4">
        <div class="card-body">
          <h2 class="section-title text-center mb-4">Cargar Ventas desde Archivo CSV</h2>
          <!-- Mensajes -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
          <!-- Formulario de carga -->
          <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
              {{ form.archivo_csv.label_tag }}
              {{ form.archivo_csv }}
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-success">Cargar archivo</button>
            </div>
          </form>
          <!-- Instrucciones -->
          <div class="mt-4">
            <strong>Formato esperado (CSV):</strong>
            <pre class="bg-light p-2 rounded">producto,fecha_venta,cantidad_vendida,precio_unitario</pre>
          </div>
          <!-- Botones de acción -->
          <div class="d-flex flex-column flex-md-row justify-content-center gap-2 mt-4">
            <a href="{% url 'app_ventas_productos:listar_ventas' %}" class="btn btn-outline-info px-4">
              <i class="bi bi-list-ul me-2"></i>Ver lista de ventas
            </a>
            <a href="{% url 'app_ventas_productos:registrar_venta' %}" class="btn btn-outline-success px-4">
              <i class="bi bi-plus-circle me-2"></i>Registrar venta manualmente
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Loader Spinner -->
<div id="loader" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(255,255,255,0.7); z-index:9999; align-items:center; justify-content:center;">
  <div class="spinner-border text-primary" style="width:4rem; height:4rem;" role="status">
    <span class="visually-hidden">Cargando...</span>
  </div>
  <div class="mt-3 text-primary fw-bold fs-5">Procesando, por favor espera...</div>
</div>

<script>
  // Muestra el loader al enviar cualquier formulario de la página
  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function() {
      document.getElementById('loader').style.display = 'flex';
    });
  });
</script>
{% endblock %}